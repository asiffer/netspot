<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Counters - netspot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="/netspot/%20favicon.png">

  
  
  <link rel="stylesheet" href="/netspot/css/style.min.d248d35f20c43b5b584063d689c2673dca4e2f3f89df5025951ffcdda705001e.css">
  

  
  
</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/netspot/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-get started">
      <a href="/netspot/get-started/">
        <span>Get started</span>
      </a>
    </li>
    
    <li class="menu-item-download">
      <a href="/netspot/download/">
        <span>Download</span>
      </a>
    </li>
    
    <li class="menu-item-advanced">
      <a href="/netspot/advanced/">
        <span>Advanced</span>
      </a>
    </li>
    
    <li class="menu-item-developer">
      <a href="/netspot/developer/">
        <span>Developer</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="/netspot/">
        
      </a>
    </div>
    <div class="logo-mobile">
      <a href="/netspot/">
        
      </a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/netspot/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-get started">
      <a href="/netspot/get-started/">
        <span>Get started</span>
      </a>
    </li>
    
    <li class="menu-item-download">
      <a href="/netspot/download/">
        <span>Download</span>
      </a>
    </li>
    
    <li class="menu-item-advanced">
      <a href="/netspot/advanced/">
        <span>Advanced</span>
      </a>
    </li>
    
    <li class="menu-item-developer">
      <a href="/netspot/developer/">
        <span>Developer</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>

    

    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <h4>Developer</h4>
  <ul>
    
    <li class="active ">
      <a href="/netspot/developer/counter/">Counters</a>
    </li>
    
    <li class="">
      <a href="/netspot/developer/stat/">Statistics</a>
    </li>
    
    <li class="">
      <a href="/netspot/developer/exporter/">Exporting module</a>
    </li>
    
    <li class="">
      <a href="/netspot/developer/toolchain/">Developer toolchain</a>
    </li>
    
  </ul>
</div>

          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Counters</h1>
<div class="content ">
  <p>Counters are elements of the <code>miner</code>. In the Go ecosystem, they must be located in the <code>miner/counter</code> sub-package.</p>
<p>Every counter is related to a network layer (or directly to a packet). The following layers are currently available:</p>
<ul>
<li>PKT (raw packet)</li>
<li>ARP</li>
<li>IPv4</li>
<li>ICMPv4</li>
<li>TCP</li>
<li>UDP</li>
</ul>
<p>A counter must implement 3 simple functions given by the interface below.</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">BaseCtrInterface</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">Name</span><span class="p">()</span> <span class="kt">string</span>  <span class="c1">// the name of the counter
</span><span class="c1"></span>	<span class="nf">Value</span><span class="p">()</span> <span class="kt">uint64</span> <span class="c1">// get back the value of the counter
</span><span class="c1"></span>	<span class="nf">Reset</span><span class="p">()</span>        <span class="c1">// method to reset the counter
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><p>In addition, it must implement a <code>Process</code> function related to
the layers it depends on. For instance, an IPv4 counter must have
a method with the following signature</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nf">Process</span><span class="p">(</span><span class="nx">ip</span> <span class="o">*</span><span class="nx">layers</span><span class="p">.</span><span class="nx">IPv4</span><span class="p">)</span>
</code></pre></div><p>You can have a look to the counters already implemented within netspot. As a general example, a counter is a simple file with the
following content.</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// &lt;layer&gt;_&lt;counter_name&gt;.go
</span><span class="c1"></span>
<span class="kn">package</span> <span class="nx">counters</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;github.com/google/gopacket/layers&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// The counter is registered at compile time
</span><span class="c1"></span>	<span class="nf">Register</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">COUNTER</span><span class="p">{</span><span class="nx">Counter</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// COUNTER is a custom Counter I made
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">COUNTER</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">BaseCtr</span>
	<span class="nx">Counter</span> <span class="kt">uint64</span>
<span class="p">}</span>

<span class="c1">// Name returns the name of the counter
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">COUNTER</span><span class="p">)</span> <span class="nf">Name</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// Value returns the current value of the counter
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">COUNTER</span><span class="p">)</span> <span class="nf">Value</span><span class="p">()</span> <span class="kt">uint64</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// Reset resets the counter
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">COUNTER</span><span class="p">)</span> <span class="nf">Reset</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// Process update the counter according to data it receives
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">COUNTER</span><span class="p">)</span> <span class="nf">Process</span><span class="p">(</span><span class="o">*</span><span class="nx">layers</span><span class="p">.</span><span class="nx">IPv4</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

</code></pre></div><p>Obviously, you can create more complex counters with additonal structures but you should keep in mind that its operation
should be rather atomic.</p>
<div class="info">
    We recall that several goroutines are likely to call the <code>Process</code> function. It means that the internal counter value access is under high concurrency. For this purpose,
you may have a look to the <a href="https://golang.org/pkg/sync/atomic/"><code>atomic/sync</code></a> package. You can also have a look to <a href="https://gobyexample.com/atomic-counters">this example</a>.
</div>

</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  

  

  
  

  
  <script type="text/javascript" src="/netspot/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>