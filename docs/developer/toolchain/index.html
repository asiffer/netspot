<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developer toolchain - netspot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="/netspot/%20favicon.png">

  
  
  <link rel="stylesheet" href="/netspot/css/style.min.d248d35f20c43b5b584063d689c2673dca4e2f3f89df5025951ffcdda705001e.css">
  

  
  
</head>

<body class='page page-default-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/netspot/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-get started">
      <a href="/netspot/get-started/">
        <span>Get started</span>
      </a>
    </li>
    
    <li class="menu-item-download">
      <a href="/netspot/download/">
        <span>Download</span>
      </a>
    </li>
    
    <li class="menu-item-advanced">
      <a href="/netspot/advanced/">
        <span>Advanced</span>
      </a>
    </li>
    
    <li class="menu-item-developer">
      <a href="/netspot/developer/">
        <span>Developer</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="/netspot/">
        
      </a>
    </div>
    <div class="logo-mobile">
      <a href="/netspot/">
        
      </a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-home">
      <a href="/netspot/">
        <span>Home</span>
      </a>
    </li>
    
    <li class="menu-item-get started">
      <a href="/netspot/get-started/">
        <span>Get started</span>
      </a>
    </li>
    
    <li class="menu-item-download">
      <a href="/netspot/download/">
        <span>Download</span>
      </a>
    </li>
    
    <li class="menu-item-advanced">
      <a href="/netspot/advanced/">
        <span>Advanced</span>
      </a>
    </li>
    
    <li class="menu-item-developer">
      <a href="/netspot/developer/">
        <span>Developer</span>
      </a>
    </li>
    
  </ul>
</div>
    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>

    

    

    
    <div class="container pt-2 pt-md-6 pb-3 pb-md-6">
      <div class="row">
        <div class="col-12 col-md-3 mb-3">
          <div class="sidebar">
            
<div class="docs-menu">
  <h4>Developer</h4>
  <ul>
    
    <li class="">
      <a href="/netspot/developer/counter/">Counters</a>
    </li>
    
    <li class="">
      <a href="/netspot/developer/stat/">Statistics</a>
    </li>
    
    <li class="">
      <a href="/netspot/developer/exporter/">Exporting module</a>
    </li>
    
    <li class="active ">
      <a href="/netspot/developer/toolchain/">Developer toolchain</a>
    </li>
    
  </ul>
</div>

          </div>
        </div>
        <div class="col-12 col-md-9">
          
<h1 class="title">Developer toolchain</h1>
<div class="content ">
  <p><code>netspot</code> is distributed as statically-compiled binaries. The final executables
notably embed the <code>libpcap</code> and <code>musl</code> libraries.
Using a musl-based system (like <a href="https://alpinelinux.org/">alpine</a>)
is then far easier to compile <code>netspot</code>.
Obviously, you can dynamically link <code>netspot</code> to <code>libpcap</code> and the
more common GNU libc, but the installation will require these
dependencies on the target system. Here, we only detail the static
build for different architectures.</p>
<p>The <a href="https://github.com/asiffer/netspot/tree/master/dev">dev/</a> includes
some utilities to build <code>netspot</code> statically.</p>
<h3 id="docker-image">Docker image</h3>
<p>First of all, you have to prepare the docker image to build netspot.
A Dockerfile is provided in the <a href="https://github.com/asiffer/netspot/tree/master/dev/image">dev/image/</a>
subfolder.</p>
<div class="highlight"><pre class="chroma"><code class="language-docker" data-lang="docker"><span class="k">FROM</span><span class="s"> golang:1.15.6-alpine</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># LIBPCAP</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> LIBPCAP_VERSION 1.9.1<span class="err">
</span><span class="err"></span><span class="k">ENV</span> LIBPCAP_DIR /libpcap<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># SYSTEM</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> PACKAGES <span class="s2">&#34;nano bash linux-headers git flex bison wget make bluez-dev bluez&#34;</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> CGO_ENABLED <span class="m">1</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> CGO_LDFLAGS <span class="s2">&#34;-L</span><span class="si">${</span><span class="nv">LIBPCAP_DIR</span><span class="si">}</span><span class="s2">/libpcap-</span><span class="si">${</span><span class="nv">LIBPCAP_VERSION</span><span class="si">}</span><span class="s2">&#34;</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> CGO_CFLAGS <span class="s2">&#34;-O2 -I</span><span class="si">${</span><span class="nv">LIBPCAP_DIR</span><span class="si">}</span><span class="s2">/libpcap-</span><span class="si">${</span><span class="nv">LIBPCAP_VERSION</span><span class="si">}</span><span class="s2">&#34;</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># CROSS COMPILATION OPTIONS</span><span class="err">
</span><span class="err"></span><span class="c"># see https://github.com/just-containers/musl-cross-make/releases/</span><span class="err">
</span><span class="err"></span><span class="k">ENV</span> GCC_VERSION 9.2.0<span class="err">
</span><span class="err"></span><span class="k">ENV</span> MUSL_CROSS_MAKE_VERSION v15<span class="err">
</span><span class="err"></span><span class="k">ENV</span> TARGET_ARCH <span class="s2">&#34;x86_64-linux arm-linux aarch64-linux&#34;</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># SYSTEM</span><span class="err">
</span><span class="err"></span><span class="k">RUN</span> apk update<span class="p">;</span> apk add <span class="nv">$PACKAGES</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># CROSS COMPILE TOOLCHAIN</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> install_toolchain.sh /install_toolchain.sh<span class="err">
</span><span class="err"></span><span class="k">RUN</span> /install_toolchain.sh<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># LIBPCAP</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> get_libpcap_sources.sh /get_libpcap_sources.sh<span class="err">
</span><span class="err"></span><span class="k">RUN</span> /get_libpcap_sources.sh<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;/bin/bash&#34;</span><span class="p">]</span><span class="err">
</span></code></pre></div><p>So you basically need to build this image (from the <code>dev/image/</code> folder)</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">docker build -t alpine-crossbuild-libpcap:latest .
</code></pre></div><p>By default, this image will produce binaries for three different architectures:
<code>amd64</code>, <code>arm</code> and <code>arm64</code>, but you can only select those you want
by setting the <code>TARGET_ARCH</code> environment variable.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">docker build --build-arg <span class="nv">TARGET_ARCH</span><span class="o">=</span><span class="s2">&#34;x86_64-linux&#34;</span> -t alpine-crossbuild-libpcap:latest .
</code></pre></div><div class="alert">
    Some environment variables must be set before building and not
when a container starts (see the bash scripts below).
</div>
<p>The Dockerfile includes two bash scripts:</p>
<ul>
<li><code>install_toolchain.sh</code>, to download the cross-compilers</li>
<li><code>get_libpcap_sources.sh</code>, to download the sources of <code>libpcap</code></li>
</ul>
<p>You can inspect these files to check what environment variables
they require.</p>
<h3 id="compilation">Compilation</h3>
<p>Now your image is ready, you just have to compile <code>netspot</code>.
The <a href="https://github.com/asiffer/netspot/tree/master/dev/build">dev/build/</a>
folder gathers scripts for this purpose.</p>
<p>The <code>builder.sh</code> script is the main file you have to run to compile
<code>netspot</code> for a specific architecture</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">builder.sh &lt;ARCH&gt;
</code></pre></div><div class="alert">
    <p>The available ARCH depend on the previous image
by default you can choose between</p>
<ul>
<li>x86_64-linux</li>
<li>arm-linux</li>
<li>aarch64-linux</li>
</ul>

</div>
<p>This script must be executed within an instance of the previous image
(container). So first, you have to run a container (here we suppose that <code>netspot</code> code
lives in <code>GOPATH/src/netspot</code> but it is likely to be different accodint to your
dev workflow):</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">docker run --detach -it -v <span class="s2">&#34;</span><span class="si">${</span><span class="nv">GOPATH</span><span class="si">}</span><span class="s2">/src/netspot:/go/src/netspot&#34;</span> --name netspot-build alpine-crossbuild-libpcap:latest
</code></pre></div><p>Then you can run the compilation for a specific architecture:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">docker <span class="nb">exec</span> netspot-build /go/src/netspot/dev/build/builder.sh &lt;ARCH&gt;
</code></pre></div><div class="info">
    The final binaries are located in the <code>bin/</code> folder.
</div>
<p>The second script (<code>run.sh</code>) is an example that combine both steps.
You can adapt it to your workflow.</p>

</div>
</div>

        </div>
      </div>
    </div>
    
  </div>

  

  

  
  

  
  <script type="text/javascript" src="/netspot/js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js"></script>
  

  
  
  
    
  


</body>

</html>